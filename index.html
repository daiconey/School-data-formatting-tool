<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>校務用データ整形ツール | 全角・半角・セル結合</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f3f4f6;
        }
        /* メインボタン：立体感とグラデーションで強調 */
        .btn-primary {
            @apply bg-gradient-to-b from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 flex items-center justify-center gap-2 transform hover:-translate-y-0.5 active:translate-y-0 active:shadow-inner border-b-4 border-blue-800 hover:border-blue-900 active:border-t-4 active:border-b-0 whitespace-nowrap;
        }
        /* サブボタン：白ベースだが枠線と影でボタンらしさを強調 */
        /* px-3 -> px-2 に変更し、whitespace-nowrapを追加 */
        .btn-secondary {
            @apply bg-white hover:bg-blue-50 text-blue-800 font-bold py-2 px-2 border border-blue-200 border-b-4 border-blue-200 rounded-lg shadow-sm hover:shadow-md transition-all duration-200 flex items-center justify-center gap-2 transform hover:-translate-y-0.5 active:translate-y-0 active:border-b-0 active:mt-1 text-xs whitespace-nowrap;
        }
        /* 削除・結合系ボタン */
        .btn-danger {
            @apply bg-white hover:bg-red-50 text-red-600 font-bold py-2 px-2 border border-red-200 border-b-4 border-red-200 rounded-lg shadow-sm hover:shadow-md transition-all duration-200 flex items-center justify-center gap-2 transform hover:-translate-y-0.5 active:translate-y-0 active:border-b-0 active:mt-1 text-xs whitespace-nowrap;
        }
        .btn-purple {
            @apply bg-white hover:bg-purple-50 text-purple-700 font-bold py-2 px-2 border border-purple-200 border-b-4 border-purple-200 rounded-lg shadow-sm hover:shadow-md transition-all duration-200 flex items-center justify-center gap-2 transform hover:-translate-y-0.5 active:translate-y-0 active:border-b-0 active:mt-1 text-xs whitespace-nowrap;
        }
        .section-card {
            @apply bg-white rounded-lg shadow-md p-4 flex flex-col h-full;
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex flex-col relative">

    <!-- ヘッダー -->
    <header class="bg-blue-800 text-white p-4 shadow-lg z-10">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i class="fa-solid fa-school"></i> 校務用データ整形ツール
            </h1>
            <div class="text-sm opacity-80">
                <span class="hidden md:inline">ブラウザで完結・サーバー送信なし・安全</span>
            </div>
        </div>
    </header>

    <!-- メインコンテンツ -->
    <main class="flex-grow container mx-auto p-4 flex flex-col md:flex-row gap-4">
        
        <!-- 入力エリア -->
        <div class="w-full md:w-1/3 section-card border-t-4 border-blue-500">
            <div class="flex justify-between items-center mb-2">
                <label for="inputText" class="text-sm font-bold text-gray-700 flex items-center gap-2">
                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">STEP 1</span>
                    変換元データ
                </label>
                <button onclick="openClearModal()" class="text-xs bg-red-50 hover:bg-red-100 text-red-600 px-3 py-1.5 rounded border border-red-200 transition-colors flex items-center gap-1 font-bold shadow-sm whitespace-nowrap">
                    <i class="fa-solid fa-trash-can"></i> 全てクリア
                </button>
            </div>
            <textarea id="inputText" class="w-full h-[500px] p-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm resize-y shadow-inner transition-colors bg-gray-50 focus:bg-white" placeholder="ここにExcel等の名簿データを貼り付けてください&#13;&#10;例：&#13;&#10;１年Ａ組　田中　太郎&#13;&#10;1年A組 鈴木 ｲﾁﾛｳ"></textarea>
            <div class="mt-2 text-xs text-gray-500 text-right font-mono" id="inputCount">0 文字</div>
        </div>

        <!-- コントロールエリア -->
        <div class="w-full md:w-1/3 flex flex-col gap-4 pr-1 pb-4">
            
            <!-- おすすめボタン -->
            <div class="bg-blue-50 p-4 rounded-xl border-2 border-blue-100 shadow-sm relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity pointer-events-none">
                    <i class="fa-solid fa-wand-magic-sparkles text-6xl text-blue-600"></i>
                </div>
                <div class="flex items-center gap-2 mb-3">
                    <span class="bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded">STEP 2</span>
                    <h3 class="font-bold text-blue-900 text-sm">おすすめ一括変換</h3>
                </div>
                <p class="text-xs text-blue-800 mb-4 font-medium opacity-80">
                    学校現場の標準形式（英数半角・カナ全角）に一発で統一します。
                </p>
                <button onclick="convertRecommended()" class="btn-primary w-full py-4 text-lg mb-2">
                    <i class="fa-solid fa-wand-magic-sparkles"></i> 標準形式へ統一
                </button>
                <div class="text-center text-[10px] text-blue-600 font-bold">
                    迷ったらこのボタン！
                </div>
            </div>

            <!-- 個別アクション -->
            <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm">
                <div class="flex items-center gap-2 mb-3 border-b border-gray-100 pb-2">
                    <span class="bg-gray-200 text-gray-700 text-xs font-bold px-2 py-1 rounded">Option</span>
                    <h3 class="font-bold text-gray-700 text-sm">個別変換アクション</h3>
                </div>
                
                <div class="space-y-4">
                    <!-- 英数字 -->
                    <div>
                        <div class="text-xs font-bold text-gray-500 mb-2 flex items-center gap-1">
                            <i class="fa-solid fa-font"></i> 英数字 <span class="text-[10px] font-normal text-gray-400">(A-Z, 0-9)</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="processText('toHalfAlpha')" class="btn-secondary">
                                <span>全角 <i class="fa-solid fa-arrow-right-long text-xs mx-1"></i> 半角</span>
                            </button>
                            <button onclick="processText('toFullAlpha')" class="btn-secondary">
                                <span>半角 <i class="fa-solid fa-arrow-right-long text-xs mx-1"></i> 全角</span>
                            </button>
                        </div>
                    </div>

                    <!-- カタカナ -->
                    <div>
                        <div class="text-xs font-bold text-gray-500 mb-2 flex items-center gap-1">
                            <i class="fa-solid fa-a"></i> カタカナ <span class="text-[10px] font-normal text-gray-400">(アイウエオ)</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="processText('toFullKana')" class="btn-secondary">
                                <span>半角 <i class="fa-solid fa-arrow-right-long text-xs mx-1"></i> 全角</span>
                            </button>
                            <button onclick="processText('toHalfKana')" class="btn-secondary">
                                <span>全角 <i class="fa-solid fa-arrow-right-long text-xs mx-1"></i> 半角</span>
                            </button>
                        </div>
                    </div>

                    <!-- スペース・セル結合（拡張） -->
                    <div>
                        <div class="text-xs font-bold text-gray-500 mb-2 flex items-center gap-1">
                            <i class="fa-solid fa-table-columns"></i> 空白・セル結合 <span class="text-[10px] font-normal text-gray-400">(Space / Tab)</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="processText('toHalfSpace')" class="btn-secondary">
                                <span>全角 <i class="fa-solid fa-arrow-right-long text-xs mx-1"></i> 半角</span>
                            </button>
                             <button onclick="processText('toFullSpace')" class="btn-secondary">
                                <span>半角 <i class="fa-solid fa-arrow-right-long text-xs mx-1"></i> 全角</span>
                            </button>
                            <!-- 結合系ボタン: テキストを短縮して1行に収める -->
                            <button onclick="processText('mergeCells')" class="btn-purple col-span-1">
                                <i class="fa-solid fa-arrows-left-right-to-line"></i> セル結合
                            </button>
                            <button onclick="processText('removeSpace')" class="btn-danger col-span-1">
                                <i class="fa-solid fa-xmark"></i> スペース削除
                            </button>
                        </div>
                        <div class="mt-1 text-[10px] text-gray-500 text-right">
                            ※「セル結合」はExcel等の列(タブ区切り)をつなげます
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- 出力エリア -->
        <div class="w-full md:w-1/3 section-card border-t-4 border-green-500 bg-gray-50">
            <div class="flex justify-between items-center mb-2">
                <label class="text-sm font-bold text-gray-700 flex items-center gap-2">
                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">STEP 3</span>
                    変換結果
                </label>
                <span id="copyMessage" class="text-xs bg-green-600 text-white px-2 py-1 rounded font-bold opacity-0 transition-opacity duration-500 shadow-sm">
                    <i class="fa-solid fa-check"></i> コピー完了!
                </span>
            </div>
            <textarea id="outputText" readonly class="w-full h-[500px] p-3 border-2 border-gray-200 rounded-lg bg-gray-100 text-gray-700 focus:outline-none font-mono text-sm resize-y" placeholder="ここに結果が表示されます"></textarea>
            <button onclick="copyToClipboard()" class="mt-4 btn-primary bg-gradient-to-b from-green-500 to-green-700 hover:from-green-600 hover:to-green-800 border-green-800 hover:border-green-900 w-full py-3">
                <i class="fa-regular fa-copy"></i> 結果をコピー
            </button>
        </div>

    </main>

    <!-- カスタム確認モーダル -->
    <div id="clearModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50 backdrop-blur-sm transition-opacity">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4 border border-gray-100 transform scale-100 transition-transform">
            <h3 class="text-lg font-bold text-gray-800 mb-2 flex items-center gap-2">
                <i class="fa-solid fa-triangle-exclamation text-yellow-500 text-xl"></i> 
                <span>確認</span>
            </h3>
            <p class="text-sm text-gray-600 mb-6 leading-relaxed">
                入力したデータをすべて消去してもよろしいですか？<br>
                <span class="text-xs text-red-500">※この操作は元に戻せません。</span>
            </p>
            <div class="flex justify-end gap-3">
                <button onclick="closeClearModal()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg font-bold transition-colors text-sm border border-transparent hover:border-gray-200">
                    キャンセル
                </button>
                <button onclick="executeClear()" class="px-5 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-bold transition-colors text-sm shadow-md flex items-center gap-2">
                    <i class="fa-solid fa-trash-can"></i> 消去する
                </button>
            </div>
        </div>
    </div>

    <script>
        // DOM要素の取得
        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');
        const inputCount = document.getElementById('inputCount');
        const copyMessage = document.getElementById('copyMessage');
        const clearModal = document.getElementById('clearModal');

        // 文字数カウント
        inputText.addEventListener('input', () => {
            inputCount.textContent = `${inputText.value.length} 文字`;
        });

        // コピー機能
        function copyToClipboard() {
            if (!outputText.value) return;
            outputText.select();
            document.execCommand('copy');
            
            // コピー完了メッセージのアニメーション
            copyMessage.classList.remove('opacity-0');
            setTimeout(() => {
                copyMessage.classList.add('opacity-0');
            }, 2000);
        }

        // モーダル操作
        function openClearModal() {
            clearModal.classList.remove('hidden');
            clearModal.classList.add('flex');
        }

        function closeClearModal() {
            clearModal.classList.add('hidden');
            clearModal.classList.remove('flex');
        }

        // モーダルの外側をクリックしても閉じる
        clearModal.addEventListener('click', (e) => {
            if (e.target === clearModal) {
                closeClearModal();
            }
        });

        function executeClear() {
            inputText.value = "";
            outputText.value = "";
            inputCount.textContent = "0 文字";
            inputText.focus();
            closeClearModal();
        }

        // ==========================================
        // 変換ロジック群
        // ==========================================

        // 英数字：全角→半角
        function toHalfWidthAlphaNum(str) {
            return str.replace(/[Ａ-Ｚａ-ｚ０-９]/g, function(s) {
                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
            });
        }

        // 英数字：半角→全角
        function toFullWidthAlphaNum(str) {
            return str.replace(/[A-Za-z0-9]/g, function(s) {
                return String.fromCharCode(s.charCodeAt(0) + 0xFEE0);
            });
        }

        // スペース：全角→半角
        function toHalfWidthSpace(str) {
            return str.replace(/　/g, ' ');
        }

        // スペース：半角→全角
        function toFullWidthSpace(str) {
            return str.replace(/ /g, '　');
        }

        // スペース削除
        function removeSpace(str) {
            return str.replace(/[ 　]/g, '');
        }

        // セル結合（タブ削除）
        function mergeCells(str) {
            // Excelからペーストした時のタブ区切りを除去
            return str.replace(/\t/g, '');
        }

        // カタカナ：半角→全角 (濁点対応版)
        function toFullWidthKana(str) {
            const kanaMap = {
                'ｶﾞ': 'ガ', 'ｷﾞ': 'ギ', 'ｸﾞ': 'グ', 'ｹﾞ': 'ゲ', 'ｺﾞ': 'ゴ',
                'ｻﾞ': 'ザ', 'ｼﾞ': 'ジ', 'ｽﾞ': 'ズ', 'ｾﾞ': 'ゼ', 'ｿﾞ': 'ゾ',
                'ﾀﾞ': 'ダ', 'ﾁﾞ': 'ヂ', 'ﾂﾞ': 'ヅ', 'ﾃﾞ': 'デ', 'ﾄﾞ': 'ド',
                'ﾊﾞ': 'バ', 'ﾋﾞ': 'ビ', 'ﾌﾞ': 'ブ', 'ﾍﾞ': 'ベ', 'ﾎﾞ': 'ﾎﾞ',
                'ﾊﾟ': 'パ', 'ﾋﾟ': 'ピ', 'ﾌﾟ': 'プ', 'ﾍﾟ': 'ペ', 'ﾎﾟ': 'ポ',
                'ｳﾞ': 'ヴ', 'ﾜﾞ': 'ヷ', 'ｦﾞ': 'ヺ',
                'ｱ': 'ア', 'ｲ': 'イ', 'ｳ': 'ウ', 'ｴ': 'エ', 'ｵ': 'オ',
                'ｶ': 'カ', 'ｷ': 'キ', 'ｸ': 'ク', 'ｹ': 'ケ', 'ｺ': 'コ',
                'ｻ': 'サ', 'ｼ': 'シ', 'ｽ': 'ス', 'ｾ': 'セ', 'ｿ': 'ソ',
                'ﾀ': 'タ', 'ﾁ': 'チ', 'ﾂ': 'ツ', 'ﾃ': 'テ', 'ﾄ': 'ト',
                'ﾅ': 'ナ', 'ﾆ': 'ニ', 'ﾇ': 'ヌ', 'ﾈ': 'ネ', 'ﾉ': 'ノ',
                'ﾊ': 'ハ', 'ﾋ': 'ヒ', 'ﾌ': 'フ', 'ﾍ': 'ヘ', 'ﾎ': 'ホ',
                'ﾏ': 'マ', 'ﾐ': 'ミ', 'ﾑ': 'ム', 'ﾒ': 'メ', 'ﾓ': 'モ',
                'ﾔ': 'ヤ', 'ﾕ': 'ユ', 'ﾖ': 'ヨ',
                'ﾗ': 'ラ', 'ﾘ': 'リ', 'ﾙ': 'ル', 'ﾚ': 'レ', 'ﾛ': 'ロ',
                'ﾜ': 'ワ', 'ｦ': 'ヲ', 'ﾝ': 'ﾝ',
                'ｧ': 'ァ', 'ｨ': 'ィ', 'ｩ': 'ゥ', 'ｪ': 'ェ', 'ｫ': 'ォ',
                'ｯ': 'ッ', 'ｬ': 'ャ', 'ｭ': 'ュ', 'ｮ': 'ョ',
                '｡': '。', '｢': '「', '｣': '」', '､': '、', '･': '・',
                'ｰ': 'ー', 'ﾞ': '゛', 'ﾟ': '゜'
            };
            
            let reg = new RegExp('(' + Object.keys(kanaMap).join('|') + ')', 'g');
            return str.replace(reg, function (match) {
                return kanaMap[match];
            });
        }

        // カタカナ：全角→半角
        function toHalfWidthKana(str) {
            const kanaMap = {
                'ガ': 'ｶﾞ', 'ギ': 'ｷﾞ', 'グ': 'ｸﾞ', 'ゲ': 'ｹﾞ', 'ゴ': 'ｺﾞ',
                'ザ': 'ｻﾞ', 'ジ': 'ｼﾞ', 'ズ': 'ｽﾞ', 'ゼ': 'ｾﾞ', 'ゾ': 'ｿﾞ',
                'ダ': 'ﾀﾞ', 'ヂ': 'ﾁﾞ', 'ヅ': 'ﾂﾞ', 'デ': 'ﾃﾞ', 'ド': 'ﾄﾞ',
                'バ': 'ﾊﾞ', 'ビ': 'ﾋﾞ', 'ブ': 'ﾌﾞ', 'ベ': 'ﾍﾞ', 'ボ': 'ﾎﾞ',
                'パ': 'ﾊﾟ', 'ピ': 'ﾋﾟ', 'プ': 'ﾌﾟ', 'ペ': 'ﾍﾟ', 'ポ': 'ﾎﾟ',
                'ヴ': 'ｳﾞ',
                'ア': 'ｱ', 'イ': 'ｲ', 'ウ': 'ｳ', 'エ': 'ｴ', 'オ': 'ｵ',
                'カ': 'ｶ', 'キ': 'ｷ', 'ク': 'ｸ', 'ケ': 'ｹ', 'コ': 'ｺ',
                'サ': 'ｻ', 'シ': 'ｼ', 'ス': 'ｽ', 'セ': 'ｾ', 'ソ': 'ｿ',
                'タ': 'ﾀ', 'チ': 'ﾁ', 'ツ': 'ﾂ', 'テ': 'ﾃ', 'ト': 'ﾄ',
                'ナ': 'ﾅ', 'ニ': 'ﾆ', 'ヌ': 'ﾇ', 'ネ': 'ﾈ', 'ノ': 'ﾉ',
                'ハ': 'ﾊ', 'ヒ': 'ﾋ', 'フ': 'ﾌ', 'ヘ': 'ﾍ', 'ホ': 'ﾎ',
                'マ': 'ﾏ', 'ミ': 'ﾐ', 'ム': 'ﾑ', 'メ': 'ﾒ', 'モ': 'ﾓ',
                'ヤ': 'ﾔ', 'ユ': 'ﾕ', 'ヨ': 'ﾖ',
                'ラ': 'ﾗ', 'リ': 'ﾘ', 'ル': 'ﾙ', 'レ': 'ﾚ', 'ロ': 'ﾛ',
                'ワ': 'ﾜ', 'ヲ': 'ｦ', 'ン': 'ﾝ',
                'ァ': 'ｧ', 'ィ': 'ｨ', 'ゥ': 'ｩ', 'ェ': 'ｪ', 'ォ': 'ｫ',
                'ッ': 'ｯ', 'ャ': 'ｬ', 'ュ': 'ｭ', 'ョ': 'ｮ',
                '。': '｡', '「': '｢', '」': '｣', '、': '､', '・': '･',
                'ー': 'ｰ', '゛': 'ﾞ', '゜': 'ﾟ'
            };
            let reg = new RegExp('(' + Object.keys(kanaMap).join('|') + ')', 'g');
            return str.replace(reg, function (match) {
                return kanaMap[match];
            });
        }

        // ==========================================
        // アクション制御
        // ==========================================

        function convertRecommended() {
            let text = inputText.value;
            if(!text) return;

            // 標準形式への変換フロー
            // 1. 英数字を半角に
            text = toHalfWidthAlphaNum(text);
            // 2. カタカナを全角に
            text = toFullWidthKana(text);
            // 3. スペースを半角に
            text = toHalfWidthSpace(text);

            outputText.value = text;
        }

        function processText(mode) {
            let text = inputText.value;
            if(!text) return;
            
            switch(mode) {
                case 'toHalfAlpha': text = toHalfWidthAlphaNum(text); break;
                case 'toFullAlpha': text = toFullWidthAlphaNum(text); break;
                case 'toFullKana': text = toFullWidthKana(text); break;
                case 'toHalfKana': text = toHalfWidthKana(text); break;
                case 'toHalfSpace': text = toHalfWidthSpace(text); break;
                case 'toFullSpace': text = toFullWidthSpace(text); break;
                case 'removeSpace': text = removeSpace(text); break;
                case 'mergeCells': text = mergeCells(text); break;
            }
            outputText.value = text;
        }

    </script>
</body>
</html>
